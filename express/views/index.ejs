<%- include('includes/head', { title: 'Home' }) %>
<main class="flex flex-col items-center min-h-screen py-10">
	<section
		id="posts"
		class="grid gap-10 max-w-xl w-full rounded-box p-10"
	></section>
</main>

<script>
	function createSinglePostHtml(post) {
		const postHTML = `
			<div class="flex flex-col gap-4">
				<img src="${
					post.imageUrl
				}" alt="Post Image" class="h-48 aspect-square object-cover rounded-field" />
				<p>Par: ${post.userId}</p>
				<p>Votes: ${post.votes}</p>
				<p>Créé le: ${new Date(post.createdAt).toLocaleString()}</p>
			</div>
		`;
		return postHTML;
	}

	function createDualPost(posts) {
		let postsHTML = "";
		for (const post of posts) {
			postsHTML += `
				<div class="grid grid-cols-2 bg-base-200 border border-base-300 p-10 gap-10 rounded-box">
					${createSinglePostHtml(post[0])}
					${createSinglePostHtml(post[1])}
				</div>
			`;
		}
		return postsHTML;
	}

	function fetchPosts(count) {
		fetch(`/post/get-dual?count=${count}`)
			.then((response) => response.json())
			.then((data) => {
				const posts = document.getElementById("posts");
				posts.innerHTML += createDualPost(data);
			})
			.catch((error) => {
				console.error("Error fetching posts:", error);
			});
	}

	document.addEventListener("DOMContentLoaded", fetchPosts(5));

	window.addEventListener("scroll", () => {
		if (window.innerHeight + window.scrollY >= document.body.offsetHeight) {
			fetchPosts(3);
		}
	});
</script>
